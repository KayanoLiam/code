**1. HTTP æœåŠ¡å™¨ (`HttpServer`)ï¼šæ ¸å¿ƒæœåŠ¡å‘˜**

*   **åŽŸæ–‡æ„æ€ï¼š** `HttpServer` è´Ÿè´£å¤„ç† HTTP è¯·æ±‚ã€‚å®ƒæŽ¥å—ä¸€ä¸ªâ€œåº”ç”¨å·¥åŽ‚â€ï¼ˆApplication Factoryï¼‰ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå·¥åŽ‚å¿…é¡»æ˜¯ `Send + Sync` çš„ï¼ˆåŽé¢å¤šçº¿ç¨‹ç»†è¯´ï¼‰ã€‚æœåŠ¡å™¨å¯åŠ¨å‰è¦å…ˆç”¨ `bind()` ç»‘å®šåˆ°ä¸€ä¸ªç½‘ç»œåœ°å€ï¼ˆIP + ç«¯å£ï¼‰ï¼Œå¦‚æžœç«¯å£è¢«å ç”¨ä¼šå¤±è´¥ã€‚`bind()` æˆåŠŸåŽï¼Œè°ƒç”¨ `run()` è¿”å›žä¸€ä¸ª `Server` å®žä¾‹ï¼Œä½ éœ€è¦ `.await` å®ƒæˆ–è€…æŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªä»»åŠ¡ï¼ˆspawnï¼‰é‡Œï¼Œå®ƒæ‰ä¼šå¼€å§‹å¤„ç†è¯·æ±‚ï¼Œç›´åˆ°æ”¶åˆ°å…³é—­ä¿¡å·ï¼ˆæ¯”å¦‚ Ctrl+Cï¼‰ã€‚
*   **å¤§ç™½è¯è§£é‡Šï¼š**
    *   `HttpServer` å°±æ˜¯ä½ ç½‘ç«™çš„æ€»æœåŠ¡å‘˜ã€‚å®ƒçš„ä¸»è¦å·¥ä½œå°±æ˜¯ç›‘å¬ç½‘ç»œä¸Šçš„åŠ¨é™ï¼ŒæŽ¥æ”¶å®¢äººï¼ˆæµè§ˆå™¨ï¼‰å‘æ¥çš„ HTTP è¯·æ±‚ã€‚
    *   ä½ è¦å‘Šè¯‰å®ƒæ€Žä¹ˆåšèœè°±ï¼ˆæä¾›ä¸€ä¸ªâ€œåº”ç”¨å·¥åŽ‚â€å‡½æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰å†™çš„ `|| App::new()...` é‚£éƒ¨åˆ†ï¼‰ã€‚è¿™ä¸ªå·¥åŽ‚å‡½æ•°å¾—ä¿è¯èƒ½å®‰å…¨åœ°è¢«å¤šä¸ªæœåŠ¡å‘˜ï¼ˆçº¿ç¨‹ï¼‰åŒæ—¶ä½¿ç”¨ï¼ˆè¿™å°±æ˜¯ `Send + Sync` çš„è¦æ±‚ï¼ŒåŽé¢ä¼šç»†è®²ï¼‰ã€‚
    *   å…‰æœ‰èœè°±è¿˜ä¸è¡Œï¼Œå¾—å‘Šè¯‰æœåŠ¡å‘˜åœ¨å“ªå„¿å¼€åº— (`bind`)ï¼Œæ¯”å¦‚åœ¨ `127.0.0.1` è¿™ä¸ªåœ°å€çš„ `8080` ç«¯å£ã€‚å¦‚æžœè¿™ä¸ªåœ°æ–¹å·²ç»è¢«åˆ«äººå äº†ï¼ˆç«¯å£è¢«å ç”¨ï¼‰ï¼Œå¼€åº—å°±ä¼šå¤±è´¥ã€‚
    *   åº—å¼€å¥½äº† (`bind` æˆåŠŸäº†)ï¼Œè¿˜å¾—å–Šä¸€å£°â€œå¼€å§‹è¥ä¸šï¼â€ (`run`)ã€‚ä½†è¿™è¿˜ä¸å¤Ÿï¼Œä½ å¾—è®©å®ƒä¸€ç›´è¥ä¸šä¸‹åŽ»ï¼Œæ‰€ä»¥è¦ `.await` å®ƒã€‚è¿™æ ·æœåŠ¡å™¨å°±ä¼šä¸€ç›´è¿è¡Œï¼Œä¸åœåœ°æŽ¥å®¢å¤„ç†è¯·æ±‚ï¼Œç›´åˆ°ä½ æ‰‹åŠ¨åœæ­¢å®ƒï¼ˆæ¯”å¦‚åœ¨å‘½ä»¤è¡ŒæŒ‰ Ctrl+Cï¼‰ã€‚
*   **ä»£ç å›žé¡¾ï¼ˆæœ€åŸºæœ¬ç»“æž„ï¼‰ï¼š**

    ```rust
    use actix_web::{web, App, HttpResponse, HttpServer};

    #[actix_web::main]
    async fn main() -> std::io::Result<()> {
        HttpServer::new(|| { // 1. æä¾›åº”ç”¨å·¥åŽ‚ (èœè°±)
            App::new().route("/", web::get().to(HttpResponse::Ok)) // å®šä¹‰ä¸€ä¸ªç®€å•çš„è·¯ç”±
        })
        .bind(("127.0.0.1", 8080))? // 2. ç»‘å®šåœ°å€å’Œç«¯å£ (å¼€åº—ä½ç½®)
        .run()                      // 3. å¼€å§‹è¿è¡Œ (å¼€å§‹è¥ä¸š)
        .await                      // 4. ç­‰å¾…æœåŠ¡å™¨è¿è¡Œ (æŒç»­è¥ä¸š)
    }
    ```

**2. å¤šçº¿ç¨‹ï¼šä¸€ç¾¤æœåŠ¡å‘˜ä¸€èµ·å¹²æ´»**

*   **åŽŸæ–‡æ„æ€ï¼š** `HttpServer` é»˜è®¤ä¼šè‡ªåŠ¨å¯åŠ¨å¤šä¸ª HTTP å·¥ä½œçº¿ç¨‹ï¼ˆworkerï¼‰ï¼Œæ•°é‡ç­‰äºŽä½ ç”µè„‘çš„ç‰©ç† CPU æ ¸å¿ƒæ•°ã€‚å¯ä»¥ç”¨ `workers()` æ–¹æ³•æŒ‡å®šæ•°é‡ã€‚æ¯ä¸ª worker éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ `App` å®žä¾‹ï¼Œå®ƒä»¬ä¹‹é—´çš„çŠ¶æ€é»˜è®¤ä¸å…±äº«ã€‚åº”ç”¨çŠ¶æ€æœ¬èº«ä¸éœ€è¦æ˜¯ `Send` æˆ– `Sync`ï¼Œä½†åº”ç”¨å·¥åŽ‚å¿…é¡»æ˜¯ `Send + Sync`ã€‚è¦è·¨çº¿ç¨‹å…±äº«çŠ¶æ€ï¼Œç”¨ `Arc`/`Data` (å°±åƒä¹‹å‰è®²çš„å…±äº«è®¡æ•°å™¨ä¾‹å­)ï¼Œä½†è¦æ³¨æ„åŠ é”å¯èƒ½å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚é¿å…åœ¨å¤„ç†å‡½æ•°é‡Œå†™é˜»å¡žä»£ç  (å¦‚ `std::thread::sleep`)ï¼Œåº”è¯¥ç”¨ `async/await` (å¦‚ `tokio::time::sleep`)ï¼Œå¦åˆ™ä¼šå¡ä½æ•´ä¸ª workerã€‚
*   **å¤§ç™½è¯è§£é‡Šï¼š**
    *   ä¸ºäº†è®©ç½‘ç«™å“åº”æ›´å¿«ï¼ŒActix å¾ˆèªæ˜Žï¼Œå®ƒä¸ä¼šåªé›‡ä¸€ä¸ªæœåŠ¡å‘˜ï¼Œè€Œæ˜¯ä¼šæ ¹æ®ä½ ç”µè„‘ CPU çš„èƒ½åŠ›ï¼ˆæœ‰å¤šå°‘ä¸ªæ ¸ï¼‰è‡ªåŠ¨é›‡ä½£ä¸€å¸®æœåŠ¡å‘˜ï¼ˆå·¥ä½œçº¿ç¨‹ï¼‰åŒæ—¶å¹²æ´»ã€‚é»˜è®¤æ˜¯ CPU æ ¸æ•°ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ç”¨ `.workers(æ•°é‡)` æ¥æŒ‡å®šé›‡ä½£å‡ ä¸ªï¼Œæ¯”å¦‚ `.workers(4)` å°±æ˜¯é›‡ 4 ä¸ªã€‚
    *   **é‡è¦ï¼** æ¯ä¸ªæœåŠ¡å‘˜é¢†åˆ°çš„æ˜¯ä¸€ä»½ *ç‹¬ç«‹çš„* åº”ç”¨ç¨‹åº (`App`) å®žä¾‹å’Œå®ƒåŒ…å«çš„çŠ¶æ€ï¼è¿™æ„å‘³ç€ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å‘˜ A ä¿®æ”¹äº†è‡ªå·±çš„çŠ¶æ€æ•°æ®ï¼ŒæœåŠ¡å‘˜ B æ˜¯ä¸çŸ¥é“çš„ï¼Œå®ƒä»¬äº’ä¸å½±å“ã€‚è¿™ç®€åŒ–äº†å¾ˆå¤šå¹¶å‘é—®é¢˜ã€‚
    *   è™½ç„¶æ¯ä¸ªæœåŠ¡å‘˜çš„åº”ç”¨çŠ¶æ€æ˜¯ç‹¬ç«‹çš„ï¼Œä½†åˆ›å»ºè¿™äº›åº”ç”¨çš„é‚£ä¸ªâ€œå·¥åŽ‚å‡½æ•°â€ï¼ˆ`|| App::new()...`ï¼‰å¿…é¡»æ˜¯èƒ½å®‰å…¨åœ°è¢«æ‰€æœ‰æœåŠ¡å‘˜å…±äº«çš„ï¼Œè¿™å°±æ˜¯å®ƒéœ€è¦ `Send + Sync` çš„åŽŸå› ã€‚ï¼ˆå¯ä»¥ç†è§£ä¸ºï¼šèœè°±æœ¬èº«è¦èƒ½è¢«æ‰€æœ‰åŽ¨å¸ˆå®‰å…¨åœ°çœ‹å’Œä½¿ç”¨ï¼‰ã€‚
    *   å¦‚æžœä½ ç¡®å®žéœ€è¦æ‰€æœ‰æœåŠ¡å‘˜å…±äº« *åŒä¸€ä»½* æ•°æ®ï¼ˆæ¯”å¦‚å…¨å±€è®¿é—®è®¡æ•°å™¨ï¼‰ï¼Œå°±å¿…é¡»ç”¨æˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„ `web::Data`ï¼ˆé‡Œé¢æ˜¯ `Arc`ï¼‰åŒ…èµ·æ¥ï¼Œå¹¶ä¸”åœ¨ `HttpServer::new()` *å¤–é¢* åˆ›å»ºï¼Œç„¶åŽ `.clone()` è¿›åŽ»ã€‚å¦‚æžœè¿™ä¸ªå…±äº«æ•°æ®è¿˜éœ€è¦ä¿®æ”¹ï¼Œå°±å¾—ç”¨ `Mutex` ä¹‹ç±»çš„é”æ¥ä¿æŠ¤ï¼Œä½†è¦æ³¨æ„åŠ é”è§£é”ä¼šæ¶ˆè€—æ—¶é—´ï¼Œå¯èƒ½å½±å“æ€§èƒ½ã€‚
    *   **æžå…¶é‡è¦ï¼** åƒä¸‡ä¸è¦åœ¨ä½ çš„å¤„ç†å‡½æ•°ï¼ˆæˆ–ä»»ä½•è¯·æ±‚å¤„ç†ç›¸å…³çš„ä»£ç ï¼‰é‡Œå†™é‚£ç§ä¼šè®©å½“å‰çº¿ç¨‹â€œæ­»ç­‰â€çš„ä»£ç ï¼Œæ¯”å¦‚ `std::thread::sleep(Duration::from_secs(5))`ã€‚è¿™ä¼šå¯¼è‡´é‚£ä¸ªæœåŠ¡å‘˜å¡ä½ 5 ç§’é’Ÿï¼Œå®Œå…¨ä¸èƒ½å¤„ç†å…¶ä»–ä»»ä½•è¯·æ±‚ï¼è¿™éžå¸¸ç³Ÿç³•ï¼
    *   æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ `async` å‡½æ•°å’Œ `await`ã€‚æ¯”å¦‚ï¼Œå¦‚æžœä½ éœ€è¦ç­‰å¾… 5 ç§’ï¼Œåº”è¯¥ç”¨ `tokio::time::sleep(Duration::from_secs(5)).await`ã€‚è¿™æ ·ï¼Œåœ¨ç­‰å¾…çš„æ—¶å€™ï¼Œé‚£ä¸ªæœåŠ¡å‘˜å¯ä»¥æŠŠæ‰‹å¤´è¿™ä¸ªä»»åŠ¡æš‚åœä¸€ä¸‹ï¼ŒåŽ»å¤„ç†å…¶ä»–å®¢äººçš„è¯·æ±‚ï¼Œç­‰æ—¶é—´åˆ°äº†å†å›žæ¥ç»§ç»­ï¼Œæ•ˆçŽ‡é«˜å¾—å¤šã€‚æ‰€æœ‰è€—æ—¶çš„æ“ä½œï¼ˆå¦‚è¯»å†™æ–‡ä»¶ã€è®¿é—®æ•°æ®åº“ã€è°ƒç”¨å¤–éƒ¨ APIï¼‰éƒ½åº”è¯¥ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œã€‚
*   **ä»£ç ç¤ºä¾‹ï¼ˆæŒ‡å®š worker æ•°é‡ï¼‰ï¼š**

    ```rust
    use actix_web::{web, App, HttpResponse, HttpServer};

    #[actix_web::main]
    async fn main() -> std::io::Result<()> { // æ”¹ä¸ºè¿”å›ž Result
        HttpServer::new(|| App::new().route("/", web::get().to(HttpResponse::Ok)))
            .workers(4) // æŒ‡å®šå¯åŠ¨ 4 ä¸ªå·¥ä½œçº¿ç¨‹ (æœåŠ¡å‘˜)
            .bind(("127.0.0.1", 8080))?
            .run()
            .await
    }
    ```
*   **ä»£ç ç¤ºä¾‹ï¼ˆé˜»å¡ž vs å¼‚æ­¥ç­‰å¾…ï¼‰ï¼š**

    ```rust
    use actix_web::{web, Responder};
    use std::time::Duration;

    // é”™è¯¯ç¤ºèŒƒï¼šä¼šå¡ä½å·¥ä½œçº¿ç¨‹ï¼
    fn my_handler_blocking() -> impl Responder {
        println!("å¼€å§‹é˜»å¡žç­‰å¾…...");
        std::thread::sleep(Duration::from_secs(5)); // éžå¸¸ç³Ÿç³•ï¼çº¿ç¨‹ä¼šåœ¨è¿™é‡Œå¡ä½ 5 ç§’ï¼
        println!("é˜»å¡žç­‰å¾…ç»“æŸï¼");
        "response after blocking"
    }

    // æ­£ç¡®ç¤ºèŒƒï¼šä½¿ç”¨ async/await
    async fn my_handler_async() -> impl Responder {
        println!("å¼€å§‹å¼‚æ­¥ç­‰å¾…...");
        tokio::time::sleep(Duration::from_secs(5)).await; // æ­£ç¡®ï¼ç­‰å¾…æ—¶ï¼Œçº¿ç¨‹å¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚
        println!("å¼‚æ­¥ç­‰å¾…ç»“æŸï¼");
        "response after async wait"
    }

    // åœ¨ä½ çš„ App ä¸­æ³¨å†Œè¿™ä¸¤ä¸ªè·¯ç”±æ¥æµ‹è¯•ï¼š
    // .route("/blocking", web::get().to(my_handler_blocking))
    // .route("/async", web::get().to(my_handler_async))
    // å¿«é€Ÿè¿žç»­è®¿é—® /blocking ä¼šå‘çŽ°åŽé¢çš„è¯·æ±‚è¦ç­‰å¾ˆä¹…ï¼Œè€Œè®¿é—® /async åˆ™å‡ ä¹ŽåŒæ—¶å“åº”ã€‚
    ```

**3. TLS / HTTPSï¼šç»™ç½‘ç«™åŠ æŠŠé”**

*   **åŽŸæ–‡æ„æ€ï¼š** Actix Web æ”¯æŒä¸¤ç§ TLS å®žçŽ°ï¼š`rustls` å’Œ `openssl`ã€‚é€šè¿‡åœ¨ `Cargo.toml` ä¸­å¯ç”¨ `features` æ¥é€‰æ‹©ã€‚ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `openssl`ï¼šåŠ è½½ç§é’¥ (`key.pem`) å’Œè¯ä¹¦é“¾ (`cert.pem`) æ–‡ä»¶ï¼Œé…ç½® `SslAcceptor`ï¼Œç„¶åŽä½¿ç”¨ `bind_openssl()` ä»£æ›¿ `bind()` æ¥å¯åŠ¨ HTTPS æœåŠ¡å™¨ã€‚æä¾›äº†ç”Ÿæˆè‡ªç­¾åè¯ä¹¦çš„ `openssl` å‘½ä»¤ã€‚
*   **å¤§ç™½è¯è§£é‡Šï¼š**
    *   ä½ æƒ³è®©ä½ çš„ç½‘ç«™æ›´å®‰å…¨ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºä¸€ä¸ªå°é”å›¾æ ‡å—ï¼Ÿé‚£å°±éœ€è¦å¯ç”¨ HTTPSã€‚HTTPS å°±æ˜¯åŠ å¯†ç‰ˆçš„ HTTPï¼Œèƒ½ä¿æŠ¤ç”¨æˆ·å’Œä½ æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„æ•°æ®ä¸è¢«å·çœ‹æˆ–ç¯¡æ”¹ã€‚
    *   Actix Web å†…ç½®æ”¯æŒä¸¤ç§å®žçŽ° HTTPS çš„åº“ï¼š`rustls`ï¼ˆçº¯ Rust å®žçŽ°ï¼Œæ›´çŽ°ä»£ï¼‰å’Œ `openssl`ï¼ˆè€ç‰Œã€å¹¿æ³›ä½¿ç”¨çš„åº“ï¼‰ã€‚ä½ éœ€è¦é€‰ä¸€ä¸ªã€‚
    *   **æ€Žä¹ˆé€‰ï¼Ÿ** åœ¨ä½ çš„é¡¹ç›®é…ç½®æ–‡ä»¶ `Cargo.toml` é‡Œï¼Œç»™ `actix-web` ä¾èµ–åŠ ä¸Š `features = ["openssl"]` æˆ– `features = ["rustls"]`ã€‚ç¤ºä¾‹ç”¨çš„æ˜¯ `openssl`ã€‚
    *   è¦å¯ç”¨ HTTPSï¼Œä½ éœ€è¦ä¸¤æ ·ä¸œè¥¿ï¼š
        1.  **ç§é’¥ (Private Key)**ï¼šé€šå¸¸æ˜¯ä¸€ä¸ª `.pem` æˆ– `.key` æ–‡ä»¶ï¼Œè¿™æ˜¯ä½ æœåŠ¡å™¨çš„ç»å¯†å°ç« ï¼Œç»å¯¹ä¸èƒ½æ³„éœ²ã€‚
        2.  **è¯ä¹¦ (Certificate)**ï¼šé€šå¸¸æ˜¯ä¸€ä¸ª `.pem` æˆ– `.crt` æ–‡ä»¶ï¼Œè¿™æ˜¯æƒå¨æœºæž„ï¼ˆæˆ–è€…ä½ è‡ªå·±ï¼Œç”¨äºŽæµ‹è¯•ï¼‰é¢å‘çš„ï¼Œè¯æ˜Žä½ ç½‘ç«™èº«ä»½çš„â€œèº«ä»½è¯â€ã€‚æµè§ˆå™¨ä¼šæ£€æŸ¥è¿™ä¸ªè¯ä¹¦ã€‚
    *   ç¤ºä¾‹ä»£ç æ•™ä½ æ€Žä¹ˆåšï¼ˆç”¨ `openssl` åº“ï¼‰ï¼š
        1.  ç”¨ `openssl` çš„å‘½ä»¤ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ã€è‡ªç­¾åçš„å¯†é’¥å’Œè¯ä¹¦æ–‡ä»¶ï¼ˆ`key.pem` å’Œ `cert.pem`ï¼‰ã€‚è¿™ä¸»è¦ç”¨äºŽå¼€å‘å’Œæµ‹è¯•ï¼Œæµè§ˆå™¨è®¿é—®æ—¶ä¼šè­¦å‘Šä¸å®‰å…¨ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘çš„â€œèº«ä»½è¯â€ã€‚æ­£å¼ä¸Šçº¿éœ€è¦å‘è¯ä¹¦é¢å‘æœºæž„ï¼ˆCAï¼‰ç”³è¯·ã€‚
        2.  åœ¨ Rust ä»£ç é‡Œï¼Œåˆ›å»ºä¸€ä¸ª `SslAcceptor` (SSL/TLS çš„æŽ¥æ”¶å™¨)ï¼Œå‘Šè¯‰å®ƒä½ çš„ç§é’¥æ–‡ä»¶åœ¨å“ªå„¿ (`.set_private_key_file()`)ï¼Œè¯ä¹¦æ–‡ä»¶åœ¨å“ªå„¿ (`.set_certificate_chain_file()`)ã€‚
        3.  æœ€åŽï¼Œå¯åŠ¨æœåŠ¡å™¨æ—¶ï¼Œä¸ç”¨ `.bind()` äº†ï¼Œæ”¹ç”¨ `.bind_openssl("åœ°å€:ç«¯å£", builder)`ï¼ŒæŠŠé…ç½®å¥½çš„ `SslAcceptor` ä¼ è¿›åŽ»ã€‚
*   **ä»£ç ç¤ºä¾‹ (`openssl`):**

    ```rust
    // 1. ä¿®æ”¹ Cargo.toml:
    // [dependencies]
    // actix-web = { version = "4", features = ["openssl"] }
    // openssl = { version = "0.10" } // éœ€è¦é¢å¤–æ·»åŠ  openssl ä¾èµ–

    use actix_web::{get, App, HttpRequest, HttpServer, Responder};
    use openssl::ssl::{SslAcceptor, SslFiletype, SslMethod}; // å¼•å…¥ openssl ç›¸å…³

    #[get("/")]
    async fn index(_req: HttpRequest) -> impl Responder {
        "Welcome securely!"
    }

    #[actix_web::main]
    async fn main() -> std::io::Result<()> {
        // å‡†å¤‡ä½ çš„ key.pem å’Œ cert.pem æ–‡ä»¶
        // å¯ä»¥ç”¨ä¸‹é¢çš„ openssl å‘½ä»¤ç”Ÿæˆ (ç”¨äºŽæµ‹è¯•):
        // openssl req -x509 -newkey rsa:4096 -nodes -keyout key.pem -out cert.pem -days 365 -subj '/CN=localhost'

        // 2. åŠ è½½ TLS å¯†é’¥å’Œè¯ä¹¦
        let mut builder = SslAcceptor::mozilla_intermediate(SslMethod::tls()).unwrap();
        builder
            .set_private_key_file("key.pem", SslFiletype::PEM) // æŒ‡å®šç§é’¥æ–‡ä»¶
            .expect("æ— æ³•åŠ è½½ç§é’¥æ–‡ä»¶ key.pem"); // æœ€å¥½åŠ ä¸Šé”™è¯¯å¤„ç†
        builder
            .set_certificate_chain_file("cert.pem") // æŒ‡å®šè¯ä¹¦æ–‡ä»¶
            .expect("æ— æ³•åŠ è½½è¯ä¹¦æ–‡ä»¶ cert.pem");

        println!("ðŸš€ HTTPS æœåŠ¡å¯åŠ¨äºŽ https://127.0.0.1:8080");

        // 3. ä½¿ç”¨ bind_openssl å¯åŠ¨ HTTPS æœåŠ¡å™¨
        HttpServer::new(|| App::new().service(index))
            .bind_openssl("127.0.0.1:8080", builder)? // æ³¨æ„è¿™é‡Œæ˜¯ bind_openssl
            .run()
            .await
    }
    ```

**4. Keep-Aliveï¼šä¿æŒè¿žæŽ¥ï¼Œæé«˜æ•ˆçŽ‡**

*   **åŽŸæ–‡æ„æ€ï¼š** Actix Web ä¼šä¿æŒ TCP è¿žæŽ¥æ‰“å¼€ï¼Œç­‰å¾…åŽç»­è¯·æ±‚ï¼Œä»¥æé«˜æ•ˆçŽ‡ã€‚å¯ä»¥é€šè¿‡ `.keep_alive()` æ–¹æ³•è®¾ç½®ï¼šå›ºå®šè¶…æ—¶ç§’æ•°ã€ä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤å€¼ã€æˆ–ç¦ç”¨ã€‚é»˜è®¤è¡Œä¸ºå–å†³äºŽ HTTP ç‰ˆæœ¬ã€‚å¯ä»¥é€šè¿‡ `HttpResponseBuilder::force_close()` å¼ºåˆ¶å…³é—­æŸä¸ªå“åº”çš„è¿žæŽ¥ã€‚
*   **å¤§ç™½è¯è§£é‡Šï¼š**
    *   æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ¯æ¬¡åŽ»åŒä¸€ä¸ªå•†åº—ä¹°ä¸œè¥¿éƒ½è¦é‡æ–°æ•²é—¨ã€æ‰“æ‹›å‘¼ã€ä»‹ç»è‡ªå·±ï¼Œæ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ï¼Ÿç½‘ç»œè¿žæŽ¥ä¹Ÿç±»ä¼¼ã€‚æµè§ˆå™¨åŠ è½½ä¸€ä¸ªç½‘é¡µï¼Œé™¤äº† HTMLï¼Œé€šå¸¸è¿˜è¦è¯·æ±‚ CSSã€JSã€å›¾ç‰‡ç­‰å¾ˆå¤šèµ„æºã€‚å¦‚æžœæ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°å»ºç«‹ TCP è¿žæŽ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ï¼Œæ•ˆçŽ‡å°±å¾ˆä½Žã€‚
    *   **Keep-Alive** å°±æ˜¯ä¸€ç§æœºåˆ¶ï¼Œè®©æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ TCP è¿žæŽ¥åœ¨ä¸€æ¬¡è¯·æ±‚ç»“æŸåŽâ€œä¿æŒæ´»åŠ›â€ä¸€æ®µæ—¶é—´ï¼Œå¦‚æžœæµè§ˆå™¨é©¬ä¸Šåˆè¦è¯·æ±‚åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„å…¶ä»–èµ„æºï¼Œå°±å¯ä»¥ç›´æŽ¥ç”¨è¿™æ¡çŽ°æˆçš„è¿žæŽ¥ï¼ŒçœåŽ»äº†é‡æ–°å»ºç«‹è¿žæŽ¥çš„å¼€é”€ã€‚
    *   Actix Web å…è®¸ä½ æŽ§åˆ¶è¿™ä¸ªâ€œä¿æŒæ´»åŠ›â€çš„æ—¶é—´ï¼š
        *   `.keep_alive(Duration::from_secs(75))`ï¼šä¿æŒ 75 ç§’ï¼Œ75 ç§’å†…æ²¡æ–°è¯·æ±‚å°±æ–­å¼€ã€‚
        *   `.keep_alive(KeepAlive::Os)`ï¼šè®©æ“ä½œç³»ç»Ÿè‡ªå·±å†³å®šä¿æŒå¤šä¹…ï¼ˆé€šå¸¸æ¯”è¾ƒé•¿ï¼‰ã€‚
        *   `.keep_alive(None)`ï¼šç¦ç”¨ Keep-Aliveï¼Œæ¯æ¬¡è¯·æ±‚å®Œå°±æ–­å¼€ã€‚
    *   é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP/1.1 å’Œ HTTP/2.0 æ˜¯å¼€å¯ Keep-Alive çš„ï¼Œè€Œè€çš„ HTTP/1.0 æ˜¯å…³é—­çš„ã€‚
    *   å¦‚æžœä½ å¸Œæœ›æŸä¸ªç‰¹å®šçš„å“åº”å¼ºåˆ¶å…³é—­è¿žæŽ¥ï¼ˆæ¯”å¦‚ç”¨æˆ·ç™»å‡ºåŽï¼‰ï¼Œå¯ä»¥åœ¨åˆ›å»ºå“åº”æ—¶è°ƒç”¨ `.force_close()`ã€‚
*   **ä»£ç ç¤ºä¾‹ï¼ˆè®¾ç½® Keep-Aliveï¼‰ï¼š**

    ```rust
    use actix_web::{http::KeepAlive, web, App, HttpResponse, HttpServer};
    use std::time::Duration;

    // å‡è®¾ app æ˜¯ä½ å·²ç»é…ç½®å¥½çš„ App::new()...
    fn app() -> App<impl actix_web::dev::ServiceFactory<
        actix_web::dev::ServiceRequest,
        Config = (),
        Response = actix_web::dev::ServiceResponse,
        Error = actix_web::Error,
        InitError = ()>
    > {
        App::new().route("/", web::get().to(HttpResponse::Ok))
    }

    #[actix_web::main]
    async fn main() -> std::io::Result<()> {
        // ç¤ºä¾‹ 1: è®¾ç½® Keep-Alive è¶…æ—¶ä¸º 75 ç§’
        let server1 = HttpServer::new(app)
            .keep_alive(Duration::from_secs(75))
            .bind(("127.0.0.1", 8081))?; // ç”¨ä¸åŒç«¯å£æˆ–åªè¿è¡Œä¸€ä¸ª

        // ç¤ºä¾‹ 2: ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ Keep-Alive è®¾ç½®
        let server2 = HttpServer::new(app)
            .keep_alive(KeepAlive::Os)
            .bind(("127.0.0.1", 8082))?;

        // ç¤ºä¾‹ 3: ç¦ç”¨ Keep-Alive
        let server3 = HttpServer::new(app)
            .keep_alive(None) // æˆ–è€… .keep_alive(KeepAlive::Disabled)
            .bind(("127.0.0.1", 8083))?;

        // æ³¨æ„ï¼šè¿™é‡Œåªæ˜¯åˆ›å»ºäº†æœåŠ¡å™¨é…ç½®ï¼Œä½ éœ€è¦ .run().await æ¥å¯åŠ¨å®ƒä»¬
        // å®žé™…åº”ç”¨ä¸­é€šå¸¸åªå¯åŠ¨ä¸€ä¸ªé…ç½®å¥½çš„æœåŠ¡å™¨
        println!("é…ç½®äº†ä¸‰ä¸ªä¸åŒ Keep-Alive çš„æœåŠ¡å™¨å®žä¾‹ (æœªå¯åŠ¨)");
        // server1.run().await?; // æ¯”å¦‚åªå¯åŠ¨ç¬¬ä¸€ä¸ª

        Ok(())
    }
    ```
*   **ä»£ç ç¤ºä¾‹ï¼ˆå¼ºåˆ¶å…³é—­è¿žæŽ¥ï¼‰ï¼š**

    ```rust
    use actix_web::{http, HttpRequest, HttpResponse};

    async fn logout_handler(_req: HttpRequest) -> HttpResponse {
        println!("ç”¨æˆ·ç™»å‡ºï¼Œå¼ºåˆ¶å…³é—­è¿žæŽ¥");
        HttpResponse::Ok()
            .force_close() // <--- åœ¨æž„å»ºå“åº”æ—¶å¼ºåˆ¶å…³é—­è¿žæŽ¥
            .body("You have been logged out.")
            // ä¹Ÿå¯ä»¥åœ¨æž„å»ºå®ŒæˆåŽè®¾ç½® header:
            // let mut resp = HttpResponse::Ok().body(...);
            // resp.head_mut().set_connection_type(http::ConnectionType::Close);
            // resp
    }
    ```

**5. ä¼˜é›…å…³é—­ (Graceful Shutdown)ï¼šä½“é¢åœ°ç»“æŸå·¥ä½œ**

*   **åŽŸæ–‡æ„æ€ï¼š** `HttpServer` æ”¯æŒä¼˜é›…å…³é—­ã€‚æ”¶åˆ°åœæ­¢ä¿¡å·ï¼ˆå¦‚ Ctrl+Cï¼‰åŽï¼Œworker ä¼šæœ‰ä¸€å®šæ—¶é—´ï¼ˆé»˜è®¤ 30 ç§’ï¼‰æ¥å®Œæˆå½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚ï¼Œè¶…æ—¶åŽå¼ºåˆ¶åœæ­¢ã€‚å¯ä»¥ç”¨ `shutdown_timeout()` ä¿®æ”¹è¶…æ—¶æ—¶é—´ã€‚æœåŠ¡å™¨ä¼šå¤„ç†å‡ ç§æ“ä½œç³»ç»Ÿä¿¡å·ã€‚
*   **å¤§ç™½è¯è§£é‡Šï¼š**
    *   å½“ä½ éœ€è¦åœæ­¢æœåŠ¡å™¨æ—¶ï¼ˆæ¯”å¦‚æ›´æ–°ä»£ç ã€é‡å¯æœåŠ¡ï¼Œæˆ–è€…ç®€å•åœ°æŒ‰ Ctrl+Cï¼‰ï¼Œä½ è‚¯å®šä¸å¸Œæœ›å®ƒâ€œå’”åš“â€ä¸€ä¸‹å°±æŠŠæ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚éƒ½ä¸­æ–­æŽ‰ï¼Œé‚£æ ·å¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·æ“ä½œå¤±è´¥æˆ–è€…æ•°æ®ä¸ä¸€è‡´ã€‚
    *   **ä¼˜é›…å…³é—­** å°±æ˜¯ä¸€ç§â€œä½“é¢â€çš„åœæ­¢æ–¹å¼ã€‚å½“æœåŠ¡å™¨æ”¶åˆ°åœæ­¢ä¿¡å·æ—¶ï¼Œå®ƒä¼šï¼š
        1.  åœæ­¢æŽ¥æ”¶æ–°çš„è¿žæŽ¥è¯·æ±‚ã€‚
        2.  ç»™å½“å‰æ­£åœ¨å¤„ç†è¯·æ±‚çš„é‚£äº› workerï¼ˆæœåŠ¡å‘˜ï¼‰ä¸€ç‚¹æ—¶é—´ï¼ˆé»˜è®¤æ˜¯ 30 ç§’ï¼‰ï¼Œè®©ä»–ä»¬æŠŠæ‰‹å¤´ä¸Šçš„æ´»å¹²å®Œã€‚
        3.  ç­‰æ‰€æœ‰è¿›è¡Œä¸­çš„è¯·æ±‚éƒ½å¤„ç†å®Œæ¯•ï¼Œæˆ–è€…è¶…è¿‡äº†è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼ŒæœåŠ¡å™¨æ‰ä¼šçœŸæ­£å®Œå…¨åœæ­¢ã€‚é‚£äº›è¶…æ—¶è¿˜æ²¡å¹²å®Œæ´»çš„ worker ä¼šè¢«å¼ºåˆ¶ç»ˆæ­¢ã€‚
    *   è¿™ä¸ªé»˜è®¤çš„ 30 ç§’ç­‰å¾…æ—¶é—´ï¼Œä½ å¯ä»¥é€šè¿‡ `.shutdown_timeout(ç§’æ•°)` æ–¹æ³•æ¥ä¿®æ”¹ã€‚æ¯”å¦‚ `.shutdown_timeout(60)` å°±æ˜¯ç»™ 60 ç§’æ—¶é—´ã€‚
    *   æœåŠ¡å™¨èƒ½è¯†åˆ«ä¸€äº›æ“ä½œç³»ç»Ÿå‘å‡ºçš„ä¿¡å·æ¥è§¦å‘å…³é—­ï¼š
        *   `Ctrl+C` (SIGINT)ï¼šåœ¨æ‰€æœ‰ç³»ç»Ÿä¸Šéƒ½æœ‰æ•ˆï¼Œé€šå¸¸æ˜¯å¼ºåˆ¶å…³é—­ï¼ˆä½† Actix å¯èƒ½ä¼šå°è¯•ä¼˜é›…å…³é—­ï¼‰ã€‚
        *   `SIGTERM` (åœ¨ Unix/Linux ç³»ç»Ÿä¸Š)ï¼šé€šå¸¸è¡¨ç¤ºå¸Œæœ›ç¨‹åºâ€œä¼˜é›…åœ°â€é€€å‡ºï¼Œè¿™æ˜¯æœ€æŽ¨èçš„å…³é—­æ–¹å¼ã€‚
        *   `SIGQUIT` (åœ¨ Unix/Linux ç³»ç»Ÿä¸Š)ï¼šé€šå¸¸è¡¨ç¤ºå¼ºåˆ¶é€€å‡ºï¼Œå¹¶å¯èƒ½ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼ˆcore dumpï¼‰ã€‚
*   **ä»£ç ç¤ºä¾‹ï¼ˆè®¾ç½®å…³é—­è¶…æ—¶ï¼‰ï¼š**

    ```rust
    use actix_web::{web, App, HttpResponse, HttpServer};
    use std::time::Duration;

    #[actix_web::main]
    async fn main() -> std::io::Result<()> {
        HttpServer::new(|| App::new().route("/", web::get().to(HttpResponse::Ok)))
            .shutdown_timeout(60) // è®¾ç½®ä¼˜é›…å…³é—­çš„è¶…æ—¶æ—¶é—´ä¸º 60 ç§’
            .bind(("127.0.0.1", 8080))?
            .run()
            .await
    }
    ```
